- name: New Relic setup
  hosts: linux
  gather_facts: no
  tasks:
    - name: wait until able to reachable
      wait_for_connection:
        delay: 60
        timeout: 300
    - name: Gather facts for first time
      setup:
    - name: Ping check hosts
      ansible.builtin.ping:
    - name: Print message
      ansible.builtin.debug:
        msg: Able to connect host
    - name: add license key
      copy:
        dest: "/etc/newrelic-infra.yml"
        content: |
          license_key: e8633494910348db21863d93101da438ffc0NRAL
      become: true
      become_user: root
    - name: Install New Relic agent
      ansible.builtin.yum:
        name: newrelic-infra
        enablerepo: newrelic-infra
        state: present
      become: true
      become_user: root
    - name: Start New Relic agent
      command: systemctl restart newrelic-infra
      become: true
      become_user: root